# 实例接口

## 基础了解

> 最后更新时间：2025年7月18日15点29分

BIMWIN 前端核心实例对象可由组件方法：_组件.getPlatform()_ 获取(实例对象以下表示为 platform)，其中接口可以分为以下几类：

| 类                                            | 基本功能说明                                                               |
| --------------------------------------------- | :------------------------------------------------------------------------- |
| [Camera](#camera)                             | 获取/设置相机视角参数、相机类型切换(正交与透视)、相机定位等                |
| [Element](#element)                           | 构件状态管理(颜色/透明度/显隐/高亮)等                                      |
| [Model](#model)                               | 多模型加载、集成模型加载、模型卸载、模型聚焦、转换状态过滤、点选模式设置等 |
| [Information](#infomation)                    | 获取场景基本信息(构件数、几何数、三角形数量、顶点数量等)                   |
| [Label](#label)                               | 自定义标签添加、标签与构件关联添加、标签移除、标签显隐状态设置等           |
| [Roam](#roam)                                 | 漫游开启/关闭、路径漫游点获取、路径漫游播放等                              |
| [Effect](#effect)                             | 可自定义设置诸如光强、高光、遮蔽等的场景光照效果                           |
| [Annotation](#annotation)                     | 批注绘制设置                                                               |
| [Exploder](#exploder)                         | 控制场景及构件爆炸效果                                                     |
| [ToolKit(施工进度)](<#ToolKit(施工进度模拟)>) | 施工进度模拟                                                               |

所有类别接口均存在对应的对象实例，调用时只需：`platform.类名.接口名` 即可，例如：

```js

// 获取当前相机信息
platform.Camera.ExtractCamera();

// 设置构件隐藏
platform.Element.ShowElement(ids, true/false);

// 监听模型卸载事件
platform.BwEvent.onUninstallModel.add( (args) => { ... } );

// 终止测量
platform.bimwin.stopMeasure();
```

## Camera

Camera 类接口主要用作场景相机位置、旋转设置，及视角信息获取等作用。

### ExtractCamera

获取当前视角的相机信息

**参数**

<空>

**返回值**

| 属性       | 类型                          | 描述                                               |
| ---------- | ----------------------------- | -------------------------------------------------- |
| position   | THREE.Vector3                 | 位置向量(3D)                                       |
| rotation   | THREE.Euler                   | 欧拉角(3D)                                         |
| cameraType | 'perspective'\|'orthographic' | 相机类型( 透视-perspective 或 正交-orthographic )  |
| left       | number                        | 正交相机左侧面距离                                 |
| right      | number                        | 正交相机右侧面距离                                 |
| top        | number                        | 正交相机上侧面距离                                 |
| bottom     | number                        | 正交相机下侧面距离                                 |
| dir        | THREE.Vector3                 | 相机朝向向量(仅透视相机提供)，由屏幕外指向里的朝向 |

**示例**

```js
let cameraData = platform.Camera.ExtractCamera();
```

### SetCamera

根据相机信息设置指定的视角

**参数**

| 参数名            | 类型       | 描述                             |
| ----------------- | ---------- | -------------------------------- |
| cameraData        | cameraData | 相机信息                         |
| playAnimationTime | number     | 动画执行时间, 单位秒，必须大于 0 |

cameraData 类型：

| 属性       | 类型                          | 描述                                               |
| ---------- | ----------------------------- | -------------------------------------------------- |
| position   | THREE.Vector3                 | 位置向量(3D)                                       |
| rotation   | THREE.Euler                   | 欧拉角(3D)                                         |
| cameraType | 'perspective'\|'orthographic' | 相机类型( 正交-perspective 或 透视-orthographic )  |
| left       | number                        | 正交相机左侧面距离                                 |
| right      | number                        | 正交相机右侧面距离                                 |
| top        | number                        | 正交相机上侧面距离                                 |
| bottom     | number                        | 正交相机下侧面距离                                 |
| dir        | THREE.Vector3                 | 相机朝向向量(仅透视相机提供)，由屏幕外指向里的朝向 |

**返回值**

<空>

**示例**

```js
let cameraData = platform.Camera.ExtractCamera();
platform.Camera.SetCamera(cameraData, 10);
```

LookAt,LookAtRevit,SetFitViewDirectionByFileId

## Element

Element 类接口主要用于对模型构件(元素)的状态设置。

### FitElements

最大化构件，即聚焦构件

**参数**

| 参数名      | 类型     | 描述                        |
| ----------- | -------- | --------------------------- |
| ids         | string[] | 构件 id 数组                |
| isHighLight | boolean  | 聚焦完成后是否高亮构件      |
| ratio       | numbrt   | 放大率[0.0 - 1.0]，0.5 默认 |

**返回值**

<空>

**示例**

```js
platform.Element.FitElements(["02.1739176391748665344"], true);
```

### GetModelIds

获取所有构件 id 集合

**参数**

<空>

**返回值**

| 类型     | 描述         |
| -------- | ------------ |
| string[] | 构件 id 数组 |

**示例**

```js
let ids = platform.Element.GetModelIds();
```

### HighlightElements

高亮或取消高亮一组构件

**参数**

| 参数名 | 类型     | 描述            |
| ------ | -------- | --------------- |
| ids    | string[] | 构件 id 数组    |
| enable | boolean  | 高亮 / 取消高亮 |

**返回值**

<空>

**示例**

```js
platform.Element.HighlightElements(["02.1739176391748665344", "02.173917639174866545454"], true);
```

### TransparentElements

设置或取消构件透明状态的透明度

**参数**

| 参数名 | 类型     | 描述                                                                                         |
| ------ | -------- | -------------------------------------------------------------------------------------------- |
| ids    | string[] | 构件 id 数组                                                                                 |
| enable | boolean  | true 启用透明 / false 取消透明                                                               |
| value  | numbrt   | 透明度 [0,1], 0 完全透明，1 不透明，0.5 默认。只有当 enable 值为 true 时，透明度设置值有效。 |

**返回值**

<空>

**示例**

```js
platform.Element.TransparentElements(["02.1739176391748665344", "02.173917639174866545454"], true);
```

### SetColor

设置构件颜色

**适用版本**
v20240202 及以上

**参数**

| 参数名 | 类型     | 描述                            |
| ------ | -------- | ------------------------------- |
| ids    | string[] | 构件 id 数组                    |
| color  | string   | HTML 颜色字符,如: '#fff', 'red' |

**返回值**

<空>

**示例**

```js
platform.Element.SetColor(["02.1739176391748665344", "02.173917639174866545454"], "#fff");
```

### RemoveColor

移除通过**SetColor** API 设置的颜色，还原原本构件的颜色

**适用版本**
v20240202 及以上

**参数**

| 参数名 | 类型     | 描述         |
| ------ | -------- | ------------ |
| ids    | string[] | 构件 id 数组 |

**返回值**

<空>

**示例**

```js
platform.Element.RemoveColor(["02.1739176391748665344", "02.173917639174866545454"]);
```

### ShowElement

设置构件显示或者隐藏

**参数**

| 参数名 | 类型     | 描述                |
| ------ | -------- | ------------------- |
| ids    | string[] | 构件 id 数组        |
| enable | boolean  | 显示构件 / 隐藏构件 |

**返回值**

<空>

**示例**

```js
platform.Element.ShowElement(["02.1739176391748665344", "02.173917639174866545454"], true);
```

### HalfTransparentElement

设置构件为半透明度或者还原为正常

**参数**

| 参数名 | 类型     | 描述                                           |
| ------ | -------- | ---------------------------------------------- |
| ids    | string[] | 构件 id 数组                                   |
| enable | boolean  | true 构件设置半透明 / false 构件还原为正常状态 |

**返回值**

<空>

**示例**

```js
platform.Element.HalfTransparentElement(["02.1739176391748665344", "02.173917639174866545454"], true);
```

## Model

Model 类接口主要用于模型加载、卸载、过滤、剖切填充属性过滤等方面。

### LoadModel

加载模型

**参数**

| 参数名                   | 类型                                       | 描述    |
| ------------------------ | ------------------------------------------ | ------- |
| [fileIds](#fileids-参数) | string\|string[]\|object[]\|ModelOptions[] | 文件 id |

**返回值**

<空>

**示例**

```js
platform.Model.LoadModel(["1722816825178394624"]);
```

#### fileIds 参数

文件 id 参数支持多种模式，例如:

-   只加载单个模型，只需要传文件 id 作为 string

    ```js
    platform.Model.LoadModel("1722816825178394624");
    ```

-   同样是加载单个模型，支持传入一些配置参数

    ```js
    platform.Model.LoadModel({
        id: "1722816825178394624",
        fitView: true,
        sceneMatrix: [],
        sceneId: "111",
        projectMatrix: [],
    });
    ```

-   支持加载多个模型

    ```js
    platform.Model.LoadModel(["1722816825178394624", "1722816825178394625"]);
    ```

-   同样的，支持对每个模型进行配置

    ```js
    platform.Model.LoadModel([
        {
            id: "1722816825178394624",
            fitView: true,
            sceneMatrix: [1, 0, 0, 0, 4, 0, 0, 9, 0, 1, 10, -9],
            sceneId: "111",
            projectMatrix: [],
        },
        {
            id: "1722816825178394625",
            fitView: false,
            sceneMatrix: [1, 0, 0, 0, 4, 0, 0, 9, 0, 1, 10, -12],
            sceneId: "111",
            projectMatrix: [],
        },
    ]);
    ```

**ModelOptions 参数**

加载模型时可根据该对象属性值设置模型偏移，视角，模型 id 等，具体值如下：

| 属性          | 值                        | 描述                                                                                                      |
| ------------- | ------------------------- | --------------------------------------------------------------------------------------------------------- |
| id            | string                    | 模型 id， 即 fileId                                                                                       |
| sceneMatrix   | THREE.Matrix4 \| number[] | 模型偏移矩阵                                                                                              |
| fitView       | boolean                   | 是否聚焦到模型中心， true 聚焦到模型中心 false 不聚焦到模型中心，多模型集成时第一个应该传值后续不应该传值 |
| sceneId       | string                    | 模型分组 ID                                                                                               |
| projectMatrix | ProjectMatrixGIS          | 模型在 GIS 中的投影矩阵                                                                                   |

**ProjectMatrixGIS 参数**

```ts
interface ProjectMatrixGIS {
    // 经纬高
    destination: {
        longitude?: number;
        latitude?: number;
        height?: number;
    };
    // 旋转角
    orientation: {
        heading?: number;
        pitch?: number;
        roll?: number;
    };
}
```

### RemoveModelByFile

根据模型 id 卸载模型

**参数**

| 参数名 | 类型   | 描述    |
| ------ | ------ | ------- |
| fileId | string | 文件 id |

**返回值**

<空>

**示例**

```js
platform.Model.RemoveModelByFile("1722816825178394624");
```

### RemoveModelAll

卸载当前所有模型

**参数**

<空>

**返回值**

<空>

**示例**

```js
platform.Model.RemoveModelAll();
```

### FitModel

视角聚焦模型

**参数**

| 参数名 | 类型   | 描述    |
| ------ | ------ | ------- |
| fileId | string | 文件 id |

**返回值**

<空>

**示例**

```js
platform.Model.FitModel("1722816825178394624");
```

### SetSectionFillFilterOn

设置剖切填充属性过滤开启/关闭(默认开启)

**参数**

| 参数名 | 类型    | 描述                          |
| ------ | ------- | ----------------------------- |
| on     | boolean | 是否开启 true 开启 false 关闭 |

**返回值**

<空>

**示例**

```js
platform.Model.SetSectionFillFilterOn(true);
```

### SetSectionFillFilterCondition

添加自定义剖切填充属性名及属性值过滤条件

**参数**

| 参数名 | 类型   | 描述   |
| ------ | ------ | ------ |
| name   | string | 属性名 |
| value  | string | 属性值 |

**返回值**

<空>

**示例**

```js
platform.Model.SetSectionFillFilterCondition("handleId", "25503");
```

### ClearSectionFillFilterCondition

清除自定义剖切填充属性过滤条件

-   两个参数都不传则清除所有
-   不传属性值则清除属性名下所有属性值过滤条件

**参数**

| 参数名 | 类型   | 描述   |
| ------ | ------ | ------ |
| name   | string | 属性名 |
| value  | string | 属性值 |

**返回值**

<空>

**示例**

```js
platform.Model.ClearSectionFillFilterCondition("handleId");
```

### applayMatrixForFileId

为文件执行位置调整。只有在配置中`browseMode`为`TransformGizmo`时才生效。

**参数**

| 参数名 | 类型   | 描述   |
| ------ | ------ | ------ |
| id     | string | 文件名 |
| config |        | 值     |

**返回值**

<空>

**示例**

```js
platform.Model.applayMatrixForFileId(this.options.fileId[0], {
    translate,
    rotation: {
        x: (rotation.x / 180) * PI,
        y: (rotation.y / 180) * PI,
        z: (rotation.z / 180) * PI,
    },
    scale: {x: 1, y: 1, z: 1},
});
```

更详细可视化的示例见demo，http://172.18.3.3:2801/demo/TranslateModel

## Information

### getBaseInformation

获取场景基本信息(构件数、几何数、三角形数量、顶点数量等)。

**参数**

<空>

**返回值**

| 参数名   | 类型   | 描述     |
| -------- | ------ | -------- |
| nodeNum  | number | 构件数   |
| geoNum   | number | 几何数   |
| meshNum  | number | 三角面数 |
| pointNum | number | 顶点数   |
| lineNum  | number | 线数量   |

**示例**

```js
let info = platform.Information.getBaseInformation();
```

## Label

自定义标签添加、标签与构件关联添加、标签移除、标签显隐状态设置等。

### AddLabel

添加自定义标签

**参数**

| 参数名   | 类型                                                 | 描述                   |
| -------- | ---------------------------------------------------- | ---------------------- |
| position | THREE.Vector3 \| { x: number, y: number, z: number } | 三维坐标               |
| htmlText | string                                               | 自定义标签 html 字符串 |

**返回值**

| 类型   | 描述    |
| ------ | ------- |
| number | 标签 id |

**示例**

```js
const point = {x: 0, y: 0, Z: 0};
const labelId = platform.Label.AddLabel(point, "<span>自定义标签</span>");
```

### AddDefaultLabel

添加默认标签

**参数**

| 参数名    | 类型                                                 | 描述         |
| --------- | ---------------------------------------------------- | ------------ |
| position  | THREE.Vector3 \| { x: number, y: number, z: number } | 三维坐标     |
| text      | string                                               | 标签文本     |
| labelType | string                                               | 默认标签类型 |

**返回值**

| 类型   | 描述    |
| ------ | ------- |
| number | 标签 id |

**示例**

```js
const point = {x: 0, y: 0, Z: 0};
const labelId = platform.Label.AddDefaultLabel(point, "标签1", "default");
```

**labelType 说明**

默认的标签类型有以下几种：

| 类型 | 值        |
| ---- | --------- |
| 默认 | default   |
| 标点 | balloon   |
| 闪烁 | diffusion |
| 三维 | label_3d  |

### AddLabelToElement

添加自定义标签到构件中心

**参数**

| 参数名   | 类型   | 描述                   |
| -------- | ------ | ---------------------- |
| id       | string | 构件 id                |
| htmlText | string | 自定义标签 html 字符串 |

**返回值**

| 类型   | 描述    |
| ------ | ------- |
| number | 标签 id |

**示例**

```js
const labelId = platform.Label.AddLabelToElement("xxxxxx.xxxx.xxxx", "<span>自定义标签</span>");
```

### AddDefaultLabelToElement

添加自默认标签到构件中心，`labelType`为`default`

**参数**

| 参数名 | 类型   | 描述     |
| ------ | ------ | -------- |
| id     | string | 构件 id  |
| text   | string | 标签文本 |

**返回值**

| 类型   | 描述    |
| ------ | ------- |
| number | 标签 id |

**示例**

```js
const labelId = platform.Label.AddDefaultLabelToElement("xxxxxx.xxxx.xxxx", "标签文本");
```

### RemoveLabels

删除标签，无传参删除所有

**参数**

| 参数名   | 类型     | 描述         |
| -------- | -------- | ------------ |
| labelIds | number[] | 标签 id 数组 |

**返回值**

<空>

**示例**

```js
platform.Label.RemoveLabels(labelIds);
```

### ShowLabels

显示/隐藏标签，无传参设置所有

**参数**

| 参数名   | 类型     | 描述                 |
| -------- | -------- | -------------------- |
| labelIds | number[] | 标签 id 数组         |
| visible  | boolean  | true 显示/false 隐藏 |

**返回值**

<空>

**示例**

```js
platform.Label.ShowLabels(labelIds, true);
```

## Roam

在三维模型中进行漫游。

> 漫游接口仅三维模式下有效。

### startRoam

开启漫游模式

**参数**

<空>

**返回值**

<空>

**示例**

```js
platform.Roam.startRoam();
```

### stopRoam

关闭漫游模式

**参数**

<空>

**返回值**

<空>

**示例**

```js
platform.Roam.stopRoam();
```

### setSpeed

设置漫游移动速度

**参数**

| 参数名 | 类型   | 描述                                                    |
| ------ | ------ | ------------------------------------------------------- |
| speed  | number | 移动速度参数，默认 1，值越大移动速度越快，建议不超过 10 |

**返回值**

<空>

**示例**

```js
platform.Roam.setSpeed(1);
```

### addRoamPoint

添加当前视角为漫游路径点，返回关键帧路径点

**参数**

<空>

**返回值**

| 参数名              | 类型   | 描述         |
| ------------------- | ------ | ------------ |
| WalkthroughKeyFrame | object | 关键帧路径点 |

**示例**

```js
const keyPoint = platform.Roam.addRoamPoint();
```

**WalkthroughKeyFrame 参数说明**

WalkthroughKeyFrame 参数表示当前位置的关键帧视角数据，与之前的相机数据 CameraData 相似，其属性如下：

| 属性     | 类型          | 描述                           |
| -------- | ------------- | ------------------------------ |
| position | THREE.Vector3 | 位置向量                       |
| rotation | THREE.Vector4 | 旋转参数                       |
| left     | number        | 正交相机左侧面距离(正交相机下) |
| right    | number        | 正交相机右侧面距离(正交相机下) |
| top      | number        | 正交相机上侧面距离(正交相机下) |
| bottom   | number        | 正交相机下侧面距离(正交相机下) |
| time     | number        | 关键帧                         |

### playAnimation

播放漫游路径动画

**参数**

| 参数名                | 类型   | 描述                 |
| --------------------- | ------ | -------------------- |
| WalkthroughKeyFrame[] | array  | 关键帧路径点数组     |
| speed                 | number | 播放时间，以秒为单位 |

**返回值**

<空>

**示例**

```js
const keyPoints = [];
const keyPoint = platform.Roam.addRoamPoint();

keyPoints.push(keyPoint);

platform.Roam.playAnimation(keyPoints, 10);
```

### setGravityEffect

设置漫游是否有重力效果

**参数**

| 参数名 | 类型    | 描述                                         |
| ------ | ------- | -------------------------------------------- |
| enable | boolean | 是否开启重力影响， true 为开启，false 为关闭 |

**返回值**

<空>

**示例**

```js
platform.Roam.setGravityEffect(true);
```

### setCollisionEffect

设置漫游是否有碰撞效果

**参数**

| 参数名 | 类型    | 描述                                      |
| ------ | ------- | ----------------------------------------- |
| enable | boolean | 是否有碰撞效果，true 为开启，false 为关闭 |

**返回值**

<空>

**示例**

```js
platform.Roam.setCollisionEffect(true);
```

### setThirdPerson

开启第三人称漫游

**参数**

<空>

**返回值**

<空>

**示例**

```js
platform.Roam.setThirdPerson();
```

### setFirstPerson

开启第一人称漫游

**参数**

<空>

**返回值**

<空>

**示例**

```js
platform.Roam.setFirstPerson();
```

## Annotation

对批注样式，包括颜色、大小、类型等进行自定义设置。

### createDrawingBoard

开启批注

**参数**

<空>

**返回值**

<空>

**示例**

```js
platform.Annotation.createDrawingBoard();
```

### cancelAnnotation

取消批注

**参数**

<空>

**返回值**

<空>

**示例**

```js
platform.Annotation.cancelAnnotation();
```

### switchType

切换批注类型

**参数**

| 参数名   | 类型   | 描述     |
| -------- | ------ | -------- |
| annoType | string | 批注类型 |

**返回值**

<空>

**示例**

```js
platform.Annotation.switchType("FreeDraw");
```

**annoType 参数**

可绘制的批注形状，类型为字符串，可取值如下：

| 类型     | 值         |
| -------- | ---------- |
| 箭头     | Arrow      |
| 矩形     | Rect       |
| 圆圈     | Noval      |
| 自由绘制 | FreeDraw   |
| 文字     | Ntext      |
| 云线框   | Ncloud     |
| X 标记   | Mark       |
| 引线批注 | Leader     |
| 框选批注 | BoxSection |

### saveImage

保存批注截图为 base64 格式的图片

**参数**

<空>

**返回值**

| 参数名 | 类型   | 描述            |
| ------ | ------ | --------------- |
| url    | string | base64 格式截图 |

**示例**

```js
const url = platform.Annotation.saveImage();
```

### changeColor

更改批注填充颜色

**参数**

| 参数名 | 类型   | 描述       |
| ------ | ------ | ---------- |
| color  | string | hex 字符串 |

**返回值**

<空>

**示例**

```js
platform.Annotation.changeColor("#229933");
```

### changeFontColor

更改批注文字颜色

**参数**

| 参数名 | 类型   | 描述       |
| ------ | ------ | ---------- |
| color  | string | hex 字符串 |

**返回值**

<空>

**示例**

```js
platform.Annotation.changeFontColor("#229933");
```

### changeLineColor

更改批注线颜色

**参数**

| 参数名 | 类型   | 描述       |
| ------ | ------ | ---------- |
| color  | string | hex 字符串 |

**返回值**

<空>

**示例**

```js
platform.Annotation.changeLineColor("#229933");
```

### changeFontSize

更改批注字体大小

**参数**

| 参数名 | 类型   | 描述              |
| ------ | ------ | ----------------- |
| size   | number | 字体大小，默认 24 |

**返回值**

<空>

**示例**

```js
platform.Annotation.changeFontSize(24);
```

### changeThickness

更改批注粗细度

**参数**

| 参数名    | 类型   | 描述           |
| --------- | ------ | -------------- |
| thickness | number | 粗细度，默认 4 |

**返回值**

<空>

**示例**

```js
platform.Annotation.changeThickness(4);
```

### exportData

导出数据

> 目前只有二维进行了实现

**参数**

<空>

**返回值**

| 参数名 | 类型   | 描述       |
| ------ | ------ | ---------- |
| data   | object | 导出的数据 |
| view   | object | 导出的视角 |

**示例**

```js
platform.Annotation.exportData();
```

### importData

导入数据和视角

> 目前只有二维进行了实现

**参数**

| 参数名 | 类型   | 描述       |
| ------ | ------ | ---------- |
| data   | object | 导出的数据 |
| view   | object | 导出的视角 |

**返回值**

<空>

**示例**

```js
const {view, data} = platform.Annotation.exportData();

// ...

platform.Annotation.importData(data, view);
```

## Exploder

Exploder 类接口主要用于控制场景及构件爆炸的参数设置。

### SetExplodeOn

开启爆炸，所有爆炸参数设置及爆炸接口调用只有在开启爆炸时才会生效

**参数**

| 参数名 | 类型    | 描述                     |
| ------ | ------- | ------------------------ |
| enable | boolean | true 开启/false 关闭爆炸 |

**返回值**

<空>

**示例**

```js
platform.Exploder.SetExplodeOn(true);
```

### SetExplodeRadio

设置爆炸系数，控制炸开程度，参数`expRadio`取值在 [0 ~ 1]之间，0 表示完全不炸开，1 表示完全炸开

**参数**

| 参数名   | 类型   | 描述     |
| -------- | ------ | -------- |
| expRadio | number | 爆炸系数 |

**返回值**

<空>

**示例**

```js
platform.Exploder.SetExplodeRadio(1);
```

### GetAllExplodeType

获取所有爆炸类型

**参数**

<空>

**返回值**

| 参数名     | 类型   | 描述         |
| ---------- | ------ | ------------ |
| expTypeObj | object | 爆炸类型对象 |

**示例**

```js
const type = platform.Exploder.GetAllExplodeType(); // type = { node: 1, self: 0 }
```

### SwitchExplodeType

切换爆炸类型

**参数**

| 参数名  | 类型   | 描述     |
| ------- | ------ | -------- |
| expType | number | 爆炸类型 |

**返回值**

<空>

**示例**

```js
platform.Exploder.SwitchExplodeType(0);
```

**expType 参数**

爆炸类型，可取值如下:

| 类型     | 值  |
| -------- | --- |
| 场景爆炸 | 0   |
| 构件爆炸 | 1   |

### SetExplodeLimit

设置爆炸上限倍数，即可爆炸的距离上限为构件到爆炸中心的距离的倍数，接口仅在爆炸类型为场景爆炸中有效

**参数**

| 参数名   | 类型   | 描述                 |
| -------- | ------ | -------------------- |
| expLimit | number | 爆炸上限倍数，默认 1 |

**返回值**

<空>

**示例**

```js
platform.Exploder.SetExplodeLimit(1);
```

### ExplodeAll

一键炸开，即设置爆炸系数`expRadio`从当前值到完全炸开值 1

**参数**

| 参数名              | 类型     | 描述                                            |
| ------------------- | -------- | ----------------------------------------------- |
| needAnimation(可选) | boolean  | 是否播放动画                                    |
| onPlaying(可选)     | function | 一键炸开动画播放回调函数，返回爆炸系数 expRadio |
| onFinished(可选)    | function | 一键炸开动画结束回调函数                        |

**返回值**

<空>

**示例**

```js
platform.Exploder.ExplodeAll(
    true,
    (expRadio) => {
        // do something while animation playing with expRadio
    },
    () => {
        // do something after animation done
    }
);
```

### ResetAll

重置所有，与 ExplodeAll 相反，即设置爆炸系数`expRadio`从当前值到 0

**参数**

| 参数名              | 类型     | 描述                                            |
| ------------------- | -------- | ----------------------------------------------- |
| needAnimation(可选) | boolean  | 是否播放动画                                    |
| onPlaying(可选)     | function | 重置所有动画播放回调函数，返回爆炸系数 expRadio |
| onFinished(可选)    | function | 重置所有动画结束回调函数                        |

**返回值**

<空>

**示例**

```js
platform.Exploder.ResetAll(
    true,
    (expRadio) => {
        // do something while animation playing with expRadio
    },
    () => {
        // do something after animation done
    }
);
```

### ExplodeByFeatureAndDirection

朝指定方向和距离指定构件位移，仅在爆炸类型`expType`为构件爆炸时调用有效

**参数**

| 参数名      | 类型               | 描述                  |
| ----------- | ------------------ | --------------------- |
| params      | NodeExplodeParam[] | 参数对象数组          |
| speed(可选) | number             | 动画播放时长(单位 ms) |

**返回值**

| 参数名     | 类型                                        | 描述                 |
| ---------- | ------------------------------------------- | -------------------- |
| expNodeIds | { expId: string, param: NodeExplodeParam}[] | 爆炸记录 id 对象数组 |

**示例**

```js
const expNodeIds = platform.Exploder.ExplodeByFeatureAndDirection(
    [
        {
            ids: ["xxxx.xxxx.xxxx", "xxxx.xxxx.xxxx"],
            dir: [0, 1, 0],
            distance: 100,
        },
    ],
    1000
);
```

**NodeExplodeParam**

参数为对象参数，参数 ids 表示构件 id 字符串数组，dir 表示需要位移的方向，distance 表示朝指定方向位移的距离，其属性如下：

| 属性     | 类型                      | 说明               |
| -------- | ------------------------- | ------------------ |
| ids      | string[]                  | 构件 id 字符串数组 |
| dir      | THREE.Vector3 \| number[] | 方向向量(需归一化) |
| distance | number                    | 位移距离           |

### ResetFeatureExplode

取消构件的位移爆炸，仅在爆炸类型`expType`为构件爆炸时调用有效

**参数**

| 参数名      | 类型   | 描述                  |
| ----------- | ------ | --------------------- |
| expId       | string | 爆炸记录 id           |
| speed(可选) | number | 动画播放时长(单位 ms) |

**返回值**

<空>

**示例**

```js
platform.Exploder.ResetFeatureExplode(expId, 1000);
```

### ResetAllFeatureExplode

取消所有构件位移爆炸，仅在爆炸类型`expType`为构件爆炸时调用有效

**参数**

| 参数名      | 类型   | 描述                  |
| ----------- | ------ | --------------------- |
| speed(可选) | number | 动画播放时长(单位 ms) |

**返回值**

<空>

**示例**

```js
platform.Exploder.ResetAllFeatureExplode(1000);
```

## Measure

### getFeatureVolume

获取非封闭构件的投影体积，注意：参数需要设置为原始坐标系下的投影基准面高度值

**参数**

| 参数名     | 类型   | 描述                     |
| ---------- | ------ | ------------------------ |
| id         | string | 构件 id                  |
| baseHeight | number | 投影面的高度值，默认 100 |

**返回值**

| 参数名 | 类型   | 描述         |
| ------ | ------ | ------------ |
| volume | number | 构件投影体积 |

**示例**

```js
let vol = platform.Measure.getFeatureVolume("xxxx", 50);
```

## ToolKit(施工进度模拟)

### 启动，调整速度和循环动画

启动后才进入动画模式

**参数**

| 参数名 | 类型 | 描述 |
| ------ | ---- | ---- |
|        |      |      |

**返回值**

| 参数名 | 类型 | 描述 |
| ------ | ---- | ---- |
|        |      |      |

**示例**

```js
platform.ToolKit.ConstructionPlan.Enable = true; // true:进入动画模式，false:进入正常渲染模式
platform.ToolKit.ConstructionPlan.Loop = true; // 循环
platform.ToolKit.ConstructionPlan.Speed = 1; // 1为正常速度 [1-10]
```

### 添加构件到动画组

绑定多个构件为一个动画组，以组为单位设置动画。一个构件只能在一个动画组。

BindToGroup(name: string, ids: string[], gpId?: number) 【绑定构件到一个动画组】
BindFileToGroup(name: string, fileId: string)【绑定文件到一个动画组】
BindUngroupedToGroup(name: string, fileId?: string)【绑定文件的剩余未归类的构件到一个动画组】

**参数**

| 参数名 | 类型   | 描述                         |
| ------ | ------ | ---------------------------- |
| name   | string | 给动画组一个惟一名字         |
| ids    | string | 绑定为一组的构件 id 列表     |
| fileId | string | 以文件为单位，处理动画组数据 |
| gpId   | number | 复用的组 id,可选             |

**返回值**

| 参数名 | 类型          | 描述       |
| ------ | ------------- | ---------- |
|        | FunctionGroup | 动画组对象 |

**示例**

```js
let terrain = platform.ToolKit.ConstructionPlan.BindToGroup("地面", ["02.d6eee99bebae5deb.307240", "02.d6eee99bebae5deb.308366"]); // 绑定地面构件为一个动画组

let ungrouped = platform.ToolKit.ConstructionPlan.BindUngroupedToGroup("ungrouped", "1825743384813883393"); // 余下未绑定的构件为一个动画组
```

### 卸载动画组

从系统中卸载已绑定的动画组

UnbindGroup(fg: FunctionGroup)【卸载动画组】
UnbindAllGroups()【卸载所有动画组】

**参数**

| 参数名 | 类型          | 描述   |
| ------ | ------------- | ------ |
| fg     | FunctionGroup | 动画组 |

**返回值**

| 参数名 | 类型 | 描述 |
| ------ | ---- | ---- |
|        |      |      |

**示例**

```js
platform.ToolKit.ConstructionPlan.UnbindGroup(terrain); // 绑定地面构件为一个动画组

platform.ToolKit.ConstructionPlan.UnbindAllGroups(); // 余下未绑定的构件为一个动画组
```

### 设置动画方式

设置动画组的动画方式，有显示，生长，放置动画

BindShowingKeyFrame(fg: FunctionGroup, start: number, duration: number)【显示动画组】
BindGrowingKeyFrame(fg: FunctionGroup, start: number, duration: number, growType: GrowingType)【生长动画组】
BindPlacingKeyFrame(fg: FunctionGroup, start: number, duration: number, showDuration: number, placingDuration: number, offset: number, offsetType: PlacingOffsetType)【放置动画组】

**参数**

| 参数名          | 类型              | 描述                           |
| --------------- | ----------------- | ------------------------------ |
| fg              | FunctionGroup     | 动画组                         |
| start           | number            | 开始时间，单位秒               |
| duration        | number            | 持续时间，单位秒               |
| growType        | GrowingType       | 生长方式，生长动画用           |
| showDuration    | number            | 显示的时间，单位秒，放置动画用 |
| placingDuration | number            | 放置的时间，单位秒，放置动画用 |
| offset          | number            | 偏移值，单位米，放置动画用     |
| offsetType      | PlacingOffsetType | 偏移类型，放置动画用           |

```js
/**
 * 生长类型
 */
enum GrowingType {
    LeftToRight = 0,
    RightToLeft = 1,
    FrontToBack = 2,
    BackToFront = 3,
    BottomToTop = 4,
    TopToBottom = 5
}

/**
 * 放置类型的构件偏移方位
 */
enum PlacingOffsetType {
    FromLeft = 0,
    FromRight = 1,
    FromFront = 2,
    FromBack = 3,
    FromBottom = 4,
    FromTop = 5,
}
```

**返回值**

| 参数名 | 类型 | 描述 |
| ------ | ---- | ---- |
|        |      |      |

**示例**

```js
platform.ToolKit.ConstructionPlan.BindShowingKeyFrame(terrain, 10, 2); // 显示动画，10后显示2秒动画
platform.ToolKit.ConstructionPlan.BindGrowingKeyFrame(gp4, 8, 3, 0); // 生长动画，8秒后显示3秒从左到右动画
platform.ToolKit.ConstructionPlan.BindPlacingKeyFrame(gp9, 7, 2, 0.1, 0.5, 5, 0); // 放置动画，从左进入
```

### 播放/暂停

Play(frameT?: number)【播放】
Pause(frameT?: number)【暂停】
PauseToNext()【暂停到下一帧】
PauseToPrev()【暂停到上一帧】

**参数**

| 参数名 | 类型   | 描述   |
| ------ | ------ | ------ |
| frameT | number | 帧时间 |

注：绑定或动画方式更新后，需要主动调用 Play，更新动画系统数据

**返回值**

| 参数名 | 类型 | 描述 |
| ------ | ---- | ---- |
|        |      |      |

**示例**

```js
platform.ToolKit.ConstructionPlan.Play(0); // 开始播放
platform.ToolKit.ConstructionPlan.Pause(); // 暂停播放
```
