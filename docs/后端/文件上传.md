# 普通文件流上传

> ```url
> POST /api/oss/upload
> ```

## 说明

上传的文件小于60M时，推荐调用该接口上传文件。

## 参数
Header
| 名称         | 说明     | 类型   |
| ------------ | --------------- |------  |
| Authorization     | Bearer {Token}    | string |

Body
| 名称         | 说明     | 类型   |
| ------------ | --------------- | ------ |
| file  | 文件流 | binary |

## 响应

| 名称         | 说明     | 类型   |
| ------------ | -------- | ------ |
| code         | 返回码   | string |
| msg          | 提示消息 | string |
| data         | 返回数据 | json   |
| traceId      | 链路id   | string |
| responseTime | 响应时间 | string |

## 返回数据

| 名称              | 说明              | 类型   |
| ----------------- | ----------------- | ------ |
| fileUploadRecordId       | 文件id             | string |
| bucketName | minio桶名称 | string |
| keyName         | key名称         | string |
| contentType         | 链接类型          | string |
| fileSize         | 文件大小          | string |
| format         | 文件后缀名          | string |
| crc32         | 冗余校验码          | string |
| md5         | 文件唯一标识码          | string |
| createdBy         | 创建者          | string |
| createdDate         | 创建时间          | string |
| lastModifiedBy         | 最后修改者          | string |
| lastModifiedDate         | 最后修改时间          | string |
| deleted         | 删除标志          | string |
| remark         | 备注          | string |
| originalFilename         | 原文件名          | string |
| url         | 下载url          | string |




## 请求示例

##### 请求 path

> http://119.39.38.228:9986/api/oss/upload

## 请求参数

文件流


## 响应示例

```json
{
  "code" : "00000",
  "msg" : "请求成功",
  "data" : {
     "fileUploadRecordId" : "", 
     "bucketName" : "",
     "keyName" : "",
     "contentType" : "",
     "fileSize" : "",
     "format" : "",
     "crc32" : null,
     "md5" : "",
     "createdBy" : null,
     "createdDate" : "",
     "lastModifiedBy" : null,
     "lastModifiedDate" : null,
     "deleted" : false,
     "remark" : null,
     "originalFilename" : "",
     "url" : ""
  },
  "traceId" : null,
  "responseTime" : "2023-03-15 10:35:29.822"
}
```

# 创建分片上传

> ```url
> POST /api/oss/multipart-upload
> ```

## 说明

文件大于60M时，推荐使用分片上传，分片上传需要先后调用3个接口：创建分片上传、分片上传、合并分片上传。
根据文件大小以每片50M文件大小进行切片，计算切片数量。

判断本接口的返回参数hasStored为true时，则在文件服务器中已经存在相同内容的文件，无需调用分片上传和合并分片上传的接口。ossFileDTO中fileUploadRecordId为文件id。

hasStored的值为false时，还需要调用分片上传、合并分片上传接口，其中uploadId作为分片上传接口的id参数。

## 参数
Header
| 名称         | 说明     | 类型   |
| ------------ | --------------- |------  |
| Authorization     | Bearer {Token}    | string |

Body
| 名称         | 说明     | 类型   |
| ------------ | --------------- | ------ |
| objectName     | 原始文件名    | string |
| md5 | 原始文件的MD5 | string |
| totalPart | 分片数量 | int |

## 响应

| 名称         | 说明     | 类型   |
| ------------ | -------- | ------ |
| code         | 返回码   | string |
| msg          | 提示消息 | string |
| data         | 返回数据 | json   |
| traceId      | 链路id   | string |
| responseTime | 响应时间 | string |

## 返回数据

| 名称              | 说明              | 类型   |
| ----------------- | ----------------- | ------ |
| uploadId       | 分片上传文件id             | string |
| presignedUrls | 前置url数组 | array |
| requestMethod         | 响应方法         | string |
| bucketName         | minio桶名称          | string |
| keyName         | 秘钥名称          | string |
| hasStored         | 文件服务是否已经存在该文件内容的标志，true标志存在，false标志不存在          | string |
| ossFileDTO         | 文件信息对象          | OSSFILE对象 |


OSSFILE对象
| 名称              | 说明              | 类型   |
| ----------------- | ----------------- | ------ |
| fileUploadRecordId       | 文件id             | string |
| bucketName | minio桶名称 | string |
| keyName         | key名称         | string |
| contentType         | 链接类型          | string |
| fileSize         | 文件大小          | string |
| format         | 文件后缀名          | string |
| crc32         | 冗余校验码          | string |
| md5         | 文件唯一标识码          | string |
| createdBy         | 创建者          | string |
| createdDate         | 创建时间          | string |
| lastModifiedBy         | 最后修改者          | string |
| lastModifiedDate         | 最后修改时间          | string |
| deleted         | 删除标志          | string |
| remark         | 备注          | string |
| originalFilename         | 原文件名          | string |
| url         | 下载url          | string |


## 请求示例

##### 请求 path

> http://119.39.38.228:9986/api/oss/multipart-upload

## 请求参数

```json
{
   "objectName": "", 
   "md5": "",		
   "totalPart": 0  
}
```



## 响应示例

```json
{
	"code" : "00000",
  "msg" : "请求成功",
  "data" : {
    "uploadId" : null, 
    "presignedUrls" : null,
    "requestMethod" : null,
    "bucketName" : null,
    "keyName" : null,
    "hasStored" : true, 
    "ossFileDTO" : {
      "fileUploadRecordId" : "1659044208820842496", 
      "bucketName" : "pit-bimwin",
      "keyName" : "2023/03/61bc82fbcd888ada3450440bc2d1c9b0.BPT",
      "contentType" : "binary/octet-stream",
      "fileSize" : "488806399",
      "format" : "BPT",
      "crc32" : null,
      "md5" : "61bc82fbcd888ada3450440bc2d1c9b0",
      "createdBy" : null,
      "createdDate" : "2023-03-28 13:35:29",
      "lastModifiedBy" : null,
      "lastModifiedDate" : null,
      "deleted" : false,
      "remark" : null,
      "originalFilename" : "asdasd.BPT",
      "url" : ""
    }
  },
  "traceId" : null,
  "responseTime" : "2023-05-18 11:52:17.593"
}
```

# 文件分片上传

> ```url
> PUT /api/oss/multipart-upload
> ```

## 说明

文件大于60M时，推荐使用分片上传，分片上传需要先后调用3个接口：创建分片上传、分片上传、合并分片上传。

把分片后的文件逐个上传至服务器。

## 参数
Header
| 名称         | 说明     | 类型   |
| ------------ | --------------- |------  |
| Authorization     | Bearer {Token}    | string |

Body
| 名称         | 说明     | 类型   |
| ------------ | --------------- | ------ |
| uploadId     | 创建分片上传文件id    | string |
| partNumber  | 当前传输的第几个分片（从1开始） | int |
| file  | 文件流（当前分片文件流） | binary |

## 响应

| 名称         | 说明     | 类型   |
| ------------ | -------- | ------ |
| code         | 返回码   | string |
| msg          | 提示消息 | string |
| data         | 返回数据 | json   |
| traceId      | 链路id   | string |
| responseTime | 响应时间 | string |

## 返回数据

空



## 请求示例

##### 请求 path

> http://119.39.38.228:9986/api/oss/multipart-upload

## 请求参数

```json
{
   "uploadId": "", 
   "partNumber ": 2, 
   "file ": "", 
}
```



## 响应示例

```json
{
	"code" : "00000",
  "msg" : "请求成功",
  "data" : {
  },
  "traceId" : null,
  "responseTime" : "2023-05-18 11:52:17.593"
}
```

# 文件合并

> ```url
> PUT /api/oss/complete-multipart-upload
> ```

## 说明

文件大于60M时，推荐使用分片上传，分片上传需要先后调用3个接口：创建分片上传、分片上传、合并分片上传。

所有分片文件上传完成之后，合并所有分片文件，完成整个文件的分片上传。

## 参数
Header
| 名称         | 说明     | 类型   |
| ------------ | --------------- |------  |
| Authorization     | Bearer {Token}    | string |

Body
| 名称         | 说明     | 类型   |
| ------------ | --------------- | ------ |
| bucketName     | 创建分片上传返回的桶名    | string |
| keyName  | 创建分片上传返回的秘钥名称 | string |
| uploadId  | 创建分片上传返回的分片上传文件id | string |
| originalFilename  | 源文件名 | string |
| md5  | 上传源文件的MD5 | string |

## 响应

| 名称         | 说明     | 类型   |
| ------------ | -------- | ------ |
| code         | 返回码   | string |
| msg          | 提示消息 | string |
| data         | 返回数据 | json   |
| traceId      | 链路id   | string |
| responseTime | 响应时间 | string |

## 返回数据

| 名称              | 说明              | 类型   |
| ----------------- | ----------------- | ------ |
| fileUploadRecordId       | 文件id             | string |
| bucketName | minio桶名称 | string |
| keyName         | key名称         | string |
| contentType         | 链接类型          | string |
| fileSize         | 文件大小          | string |
| format         | 文件后缀名          | string |
| crc32         | 冗余校验码          | string |
| md5         | 文件唯一标识码          | string |
| createdBy         | 创建者          | string |
| createdDate         | 创建时间          | string |
| lastModifiedBy         | 最后修改者          | string |
| lastModifiedDate         | 最后修改时间          | string |
| deleted         | 删除标志          | string |
| remark         | 备注          | string |
| originalFilename         | 原文件名          | string |
| url         | 下载url          | string |


## 请求示例

##### 请求 path

> http://119.39.38.228:9986/api/oss/complete-multipart-upload

## 请求参数

```json
{
   "bucketName": "",
  "keyName": "", 
  "uploadId": "", 
  "originalFilename": "", 
  "md5": "" 
}
```



## 响应示例

```json
{
	"code": "00000",
	"msg": "请求成功",
	"data": {
		"fileUploadRecordId": 0, 
		"bucketName": "",
		"keyName": "",
		"contentType": "",
		"fileSize": 0,
		"format": "",
		"crc32": 0,
		"md5": "",
		"createdBy": "",
		"createdDate": "",
		"lastModifiedBy": "",
		"lastModifiedDate": "",
		"deleted": true,
		"remark": "",
		"originalFilename": "",
		"url": ""
	},
	"traceId": "",
	"responseTime": ""
}
```



